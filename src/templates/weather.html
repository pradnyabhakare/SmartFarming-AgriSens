<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgriSense Weather Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * { 
      font-family: 'Inter', sans-serif; 
      box-sizing: border-box;
    }
    
    body { 
      background: #f5f6fa;
      margin: 0;
      padding: 0;
    }
    
    .hero-weather-card {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      position: relative;
      overflow: hidden;
    }
    
    .hero-weather-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -10%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);
      border-radius: 50%;
      pointer-events: none;
    }

    /* Weather-based backgrounds */
    .hero-weather-card.sunny {
      background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
    }

    .hero-weather-card.rainy {
      background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);
    }

    .hero-weather-card.cloudy {
      background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    }

    .hero-weather-card.night {
      background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
    }

    /* Animated background particles */
    .weather-particles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
    }

    /* Rain animation */
    .rain-drop {
      position: absolute;
      width: 2px;
      height: 20px;
      background: linear-gradient(transparent, rgba(255,255,255,0.6), transparent);
      animation: rain-fall 1s linear infinite;
    }

    @keyframes rain-fall {
      0% {
        transform: translateY(-20px);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(400px);
        opacity: 0;
      }
    }

    /* Sun rays animation */
    .sun-rays {
      position: absolute;
      width: 300px;
      height: 300px;
      top: -100px;
      right: -100px;
      opacity: 0.1;
      animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Cloud floating animation */
    .floating-clouds {
      position: absolute;
      width: 100px;
      height: 40px;
      background: rgba(255,255,255,0.1);
      border-radius: 40px;
      animation: float 15s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateX(-20px) translateY(0px); }
      50% { transform: translateX(20px) translateY(-10px); }
    }

    .floating-clouds:nth-child(2) {
      animation-delay: -7s;
      top: 30%;
      left: 60%;
      width: 60px;
      height: 25px;
    }

    .floating-clouds:nth-child(3) {
      animation-delay: -14s;
      top: 60%;
      left: 20%;
      width: 80px;
      height: 30px;
    }
    
    .glassmorphism {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
    }
    
    .metric-card {
      background: white;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      will-change: transform;
    }
    
    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.08);
    }
    
    .hour-card {
      transition: all 0.2s ease;
      background: white;
      border: 2px solid transparent;
      border-radius: 16px;
      min-width: 120px;
      flex-shrink: 0;
    }
    
    .hour-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .hour-card.active {
      background: linear-gradient(135deg, #1e293b, #334155);
      color: white;
      transform: translateY(-2px);
    }
    
    .forecast-item {
      transition: background-color 0.2s ease;
      border-radius: 12px;
    }
    
    .forecast-item:hover {
      background: #f9fafb;
    }
    
    /* Optimized animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 24px;
    }
    
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Custom scrollbar optimization */
    .custom-scrollbar {
      scrollbar-width: thin;
      scrollbar-color: #cbd5e1 transparent;
    }
    
    .custom-scrollbar::-webkit-scrollbar {
      height: 6px;
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 10px;
    }

    /* Temperature chart container - FIXED */
    .temp-chart-container {
      width: 100%;
      height: 120px;
      position: relative;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 15px;
      border: 1px solid rgba(255,255,255,0.15);
    }

    /* SVG temperature chart styles - ENHANCED VISIBILITY */
    .temp-line {
      fill: none;
      stroke: #ffffff;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      opacity: 0.95;
    }

    .temp-area {
      fill: url(#tempGradient);
      opacity: 0.2;
    }

    .temp-point {
      fill: #ffffff;
      stroke: rgba(255,255,255,0.8);
      stroke-width: 2;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
      cursor: pointer;
    }

    .temp-point:hover {
      fill: #fbbf24;
      transform: scale(1.3);
      transition: all 0.2s ease;
    }

    .chart-grid {
      stroke: rgba(255,255,255,0.15);
      stroke-width: 1;
    }

    .chart-label {
      fill: rgba(255,255,255,0.9);
      font-size: 11px;
      text-anchor: middle;
      font-weight: 500;
    }

    /* Weather icon animations */
    .weather-icon {
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
      max-width: 100%;
      height: auto;
      display: block;
    }

    /* Animated weather icons */
    .sun-icon {
      animation: rotate 8s linear infinite;
    }

    .cloud-icon {
      animation: float 6s ease-in-out infinite;
    }

    .rain-icon .drop {
      animation: rain-drop 1.5s ease-in-out infinite;
    }

    .rain-icon .drop:nth-child(2) { animation-delay: 0.2s; }
    .rain-icon .drop:nth-child(3) { animation-delay: 0.4s; }
    .rain-icon .drop:nth-child(4) { animation-delay: 0.6s; }

    @keyframes rain-drop {
      0%, 100% { opacity: 0.3; transform: translateY(0); }
      50% { opacity: 1; transform: translateY(4px); }
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      .hero-weather-card {
        height: auto !important;
        min-height: 280px;
        padding: 1.5rem !important;
      }
      
      .hero-weather-card::before {
        width: 200px;
        height: 200px;
      }
      
      .grid-cols-12 {
        grid-template-columns: 1fr;
      }
      
      .col-span-8, .col-span-4 {
        grid-column: span 1;
      }

      .temp-chart-container {
        height: 100px;
        padding: 10px;
      }

      .hour-card {
        min-width: 100px;
        padding: 0.75rem;
      }

      .floating-clouds,
      .sun-rays {
        display: none;
      }
    }

    /* Performance optimizations */
    .gpu-accelerated {
      transform: translateZ(0);
      will-change: transform;
    }

    /* Reduce motion for accessibility */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }

      .weather-particles,
      .sun-rays,
      .floating-clouds,
      .rain-drop {
        display: none;
      }
    }

    /* Hero layout fix */
    .hero-content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      align-items: start;
      height: 200px;
    }

    @media (max-width: 768px) {
      .hero-content-grid {
        grid-template-columns: 1fr;
        height: auto;
        gap: 1rem;
      }
    }
  </style>
</head>
<body class="min-h-screen">
  
  <!-- Fixed Header -->
  <header class="w-full fixed top-0 left-0 bg-white shadow-md z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="logo font-bold text-xl text-gray-900">AgriSense</div>
      <div class="flex items-center gap-6">
        <nav class="hidden md:flex items-center gap-6">
          <a href="/" class="text-gray-900 hover:text-green-600 font-semibold transition-colors duration-200">HOME</a>
          <a href="/#feature" class="text-gray-900 hover:text-green-600 font-semibold transition-colors duration-200">FEATURES</a>
          <a href="/#about" class="text-gray-900 hover:text-green-600 font-semibold transition-colors duration-200">ABOUT</a>
          <a href="/#team" class="text-gray-900 hover:text-green-600 font-semibold transition-colors duration-200">TEAM</a>
          <a href="/#contact" class="text-gray-900 hover:text-green-600 font-semibold transition-colors duration-200">CONTACT</a>
        </nav>
        <a href="/#features" class="bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-2 rounded transition-colors duration-200">EXPLORE NOW</a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="pt-24 px-4 md:px-6 pb-12">
    <div class="max-w-7xl mx-auto">
      
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- Left Section - Main Weather -->
        <div class="lg:col-span-8 space-y-6">
          
          <!-- Loading State -->
          <div id="loading-hero" class="skeleton h-80 md:h-96"></div>
          
          <!-- Hero Weather Card -->
          <div id="hero-card" class="hero-weather-card rounded-3xl p-6 md:p-8 text-white h-80 md:h-48 relative hidden fade-in gpu-accelerated">
            <!-- Animated weather particles -->
            <div id="weather-particles" class="weather-particles"></div>
            
            <div class="relative z-10 h-full flex flex-col">
              <div class="flex items-start justify-between mb-6">
                <div>
                  <div class="flex items-center gap-2 mb-2">
                    <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    <span id="city-name" class="text-xl font-medium truncate">Loading...</span>
                  </div>
                  <p id="current-time" class="text-sm opacity-80">Today 00:00 AM</p>
                </div>
                
                <div class="text-right flex-shrink-0">
                  <div id="hero-temp" class="text-6xl md:text-8xl font-light mb-2">12°</div>
                  <p id="hero-condition" class="text-lg opacity-90">Mostly Clear</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Today's Hourly Forecast -->
          <div>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Today</h2>
            <div class="overflow-x-auto custom-scrollbar pb-2">
              <div id="hourly-cards" class="flex gap-4 min-w-max px-1">
                <!-- Loading placeholder -->
                <div class="flex gap-4">
                  <div class="skeleton w-28 h-36 rounded-2xl flex-shrink-0"></div>
                  <div class="skeleton w-28 h-36 rounded-2xl flex-shrink-0"></div>
                  <div class="skeleton w-28 h-36 rounded-2xl flex-shrink-0"></div>
                  <div class="skeleton w-28 h-36 rounded-2xl flex-shrink-0"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Metric Cards Grid -->
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            
            <!-- Wind Card -->
            <div class="metric-card p-5">
              <h3 class="text-gray-500 text-sm mb-1 font-medium">Wind</h3>
              <p class="text-gray-400 text-xs mb-3">Today wind speed</p>
              <div class="flex items-end justify-between">
                <p class="text-2xl md:text-2xl font-bold text-gray-800" id="wind-speed">12km/h</p>
                <div class="w-12 h-12 relative flex-shrink-0">
                  <svg class="w-full h-full" viewBox="0 0 48 48">
                    <circle cx="24" cy="24" r="20" fill="none" stroke="#e5e7eb" stroke-width="1"/>
                    <text x="24" y="14" text-anchor="middle" class="text-xs fill-gray-400" font-weight="600">N</text>
                    <text x="24" y="38" text-anchor="middle" class="text-xs fill-gray-400" font-weight="600">S</text>
                    <text x="10" y="27" text-anchor="middle" class="text-xs fill-gray-400" font-weight="600">W</text>
                    <text x="38" y="27" text-anchor="middle" class="text-xs fill-gray-400" font-weight="600">E</text>
                    <line id="wind-arrow" x1="24" y1="24" x2="24" y2="10" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
                    <circle cx="24" cy="24" r="2" fill="#3b82f6"/>
                  </svg>
                </div>
              </div>
            </div>

            <!-- Rain Chance Card -->
            <div class="metric-card p-5">
              <h3 class="text-gray-500 text-sm mb-1 font-medium">Rain Chance</h3>
              <p class="text-gray-400 text-xs mb-3">Today rain chance</p>
              <div class="flex items-end justify-between">
                <p class="text-2xl md:text-2xl font-bold text-gray-800" id="rain-chance">24%</p>
                <div class="w-12 h-12 relative flex-shrink-0">
                  <svg class="w-full h-full transform -rotate-90" viewBox="0 0 48 48">
                    <circle cx="24" cy="24" r="18" fill="none" stroke="#e5e7eb" stroke-width="4"/>
                    <circle id="rain-arc" cx="24" cy="24" r="18" fill="none" stroke="#3b82f6" stroke-width="4" 
                      stroke-dasharray="113" stroke-dashoffset="85" stroke-linecap="round"/>
                  </svg>
                  <div class="absolute inset-0 flex items-center justify-center text-xs font-semibold text-gray-600" id="rain-label">Low</div>
                </div>
              </div>
            </div>

            <!-- Pressure Card -->
            <div class="metric-card p-5">
              <h3 class="text-gray-500 text-sm mb-1 font-medium">Pressure</h3>
              <p class="text-gray-400 text-xs mb-3">Today Pressure</p>
              <div class="flex items-end justify-between">
                <p class="text-2xl md:text-2xl font-bold text-gray-800" id="pressure-value">720 hpa</p>
                <div class="w-12 h-12 relative flex-shrink-0">
                  <svg class="w-full h-full transform -rotate-90" viewBox="0 0 48 48">
                    <circle cx="24" cy="24" r="18" fill="none" stroke="#e5e7eb" stroke-width="4"/>
                    <circle id="pressure-arc" cx="24" cy="24" r="18" fill="none" stroke="#3b82f6" stroke-width="4" 
                      stroke-dasharray="113" stroke-dashoffset="28" stroke-linecap="round"/>
                  </svg>
                </div>
              </div>
            </div>

            <!-- UV Index Card -->
            <div class="metric-card p-5">
              <h3 class="text-gray-500 text-sm mb-1 font-medium">UV Index</h3>
              <p class="text-gray-400 text-xs mb-3">Today UV Index</p>
              <div class="flex items-end justify-between">
                <p class="text-2xl md:text-2xl font-bold text-gray-800" id="uv-value">2</p>
                <div class="w-12 h-12 relative flex-shrink-0">
                  <svg class="w-full h-full transform -rotate-90" viewBox="0 0 48 48">
                    <defs>
                      <linearGradient id="uvGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#eab308;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ef4444;stop-opacity:1" />
                      </linearGradient>
                    </defs>
                    <circle cx="24" cy="24" r="18" fill="none" stroke="#e5e7eb" stroke-width="4"/>
                    <circle id="uv-arc" cx="24" cy="24" r="18" fill="none" stroke="url(#uvGradient)" stroke-width="4" 
                      stroke-dasharray="113" stroke-dashoffset="100" stroke-linecap="round"/>
                  </svg>
                  <div class="absolute inset-0 flex items-center justify-center text-xs font-semibold text-gray-600" id="uv-label">Low</div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <!-- Right Section - Weekly Forecast -->
        <div class="lg:col-span-4">
          <div class="bg-white rounded-3xl p-6 sticky top-28">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">This Week</h2>
            <div id="weekly-forecast" class="space-y-1 max-h-[calc(100vh-200px)] overflow-y-auto custom-scrollbar">
              <!-- Loading skeleton -->
              <div class="space-y-2">
                <div class="skeleton h-16 rounded-xl"></div>
                <div class="skeleton h-16 rounded-xl"></div>
                <div class="skeleton h-16 rounded-xl"></div>
                <div class="skeleton h-16 rounded-xl"></div>
                <div class="skeleton h-16 rounded-xl"></div>
                <div class="skeleton h-16 rounded-xl"></div>
                <div class="skeleton h-16 rounded-xl"></div>
              </div>
            </div>
          </div>
        </div>

      </div>

    </div>
  </main>

  <script>
    // Configuration
    const CONFIG = {
      PUNE_COORDS: { lat: 18.5204, lon: 73.8567 },
      API_TIMEOUT: 8000,
      MAX_RETRIES: 2
    };

    // Global state
    let weatherData = null;
    let isLoading = false;
    let retryCount = 0;

    // Initialize app
    async function init() {
      try {
        await fetchWeatherWithGeolocation();
      } catch (error) {
        console.error('Initialization error:', error);
        showError('Failed to load weather data');
      }
    }

    // Geolocation with timeout
    function getCurrentPosition(options = {}) {
      return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
          reject(new Error('Geolocation not supported'));
          return;
        }

        const timeoutId = setTimeout(() => {
          reject(new Error('Geolocation timeout'));
        }, options.timeout || 5000);

        navigator.geolocation.getCurrentPosition(
          (position) => {
            clearTimeout(timeoutId);
            resolve(position);
          },
          (error) => {
            clearTimeout(timeoutId);
            reject(error);
          },
          {
            enableHighAccuracy: false,
            timeout: options.timeout || 5000,
            maximumAge: 600000
          }
        );
      });
    }

    // Fetch weather with geolocation
    async function fetchWeatherWithGeolocation() {
      if (isLoading) return;
      isLoading = true;

      try {
        let coords = CONFIG.PUNE_COORDS;
        
        try {
          const position = await getCurrentPosition({ timeout: 3000 });
          coords = {
            lat: position.coords.latitude,
            lon: position.coords.longitude
          };
        } catch (geoError) {
          console.log('Using fallback location:', geoError.message);
        }

        await fetchWeather(coords.lat, coords.lon);
      } catch (error) {
        console.error('Weather fetch error:', error);
        if (retryCount < CONFIG.MAX_RETRIES) {
          retryCount++;
          setTimeout(fetchWeatherWithGeolocation, 1000 * retryCount);
        } else {
          loadSampleData();
        }
      } finally {
        isLoading = false;
      }
    }

    // Optimized fetch with abort controller
    async function fetchWeather(lat, lon) {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), CONFIG.API_TIMEOUT);

      try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,relative_humidity_2m,precipitation,precipitation_probability,wind_speed_10m,wind_direction_10m,pressure_msl,uv_index&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max&timezone=auto`;
        
        const response = await fetch(url, {
          signal: controller.signal,
          cache: 'default'
        });

        clearTimeout(timeoutId);

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        
        if (!data.hourly || !data.daily) {
          throw new Error('Invalid API response format');
        }

        weatherData = data;
        updateDashboard();
        
      } catch (error) {
        clearTimeout(timeoutId);
        if (error.name === 'AbortError') {
          throw new Error('Request timeout');
        }
        throw error;
      }
    }

    // Load sample data as fallback
    function loadSampleData() {
      console.log('Loading sample weather data');
      weatherData = generateSampleWeatherData();
      updateDashboard();
    }

    // Generate realistic sample data
    function generateSampleWeatherData() {
      const now = new Date();
      const baseTemp = 23;
      
      return {
        latitude: 18.5204,
        longitude: 73.8567,
        hourly: {
          time: Array.from({length: 24}, (_, i) => {
            const date = new Date(now);
            date.setHours(i, 0, 0, 0);
            return date.toISOString();
          }),
          temperature_2m: Array.from({length: 24}, (_, i) => {
            const variation = Math.sin((i - 6) / 24 * Math.PI * 2) * 8;
            return baseTemp + variation + (Math.random() - 0.5) * 3;
          }),
          relative_humidity_2m: Array.from({length: 24}, () => 30 + Math.random() * 40),
          precipitation: Array.from({length: 24}, () => Math.random() < 0.2 ? Math.random() * 2 : 0),
          precipitation_probability: Array.from({length: 24}, () => Math.random() * 50),
          wind_speed_10m: Array.from({length: 24}, () => 5 + Math.random() * 10),
          wind_direction_10m: Array.from({length: 24}, () => Math.random() * 360),
          pressure_msl: Array.from({length: 24}, () => 1010 + Math.random() * 20),
          uv_index: Array.from({length: 24}, (_, i) => {
            if (i < 6 || i > 18) return 0;
            return 2 + Math.random() * 6;
          })
        },
        daily: {
          time: Array.from({length: 7}, (_, i) => {
            const date = new Date(now);
            date.setDate(date.getDate() + i);
            return date.toISOString().split('T')[0];
          }),
          temperature_2m_max: [31, 29, 27, 25, 28, 30, 26],
          temperature_2m_min: [18, 17, 16, 15, 17, 19, 16],
          precipitation_sum: [0, 1, 3, 0, 0.5, 0, 2],
          precipitation_probability_max: [10, 30, 70, 20, 25, 15, 50]
        }
      };
    }

    // Optimized dashboard update
    function updateDashboard() {
      requestAnimationFrame(() => {
        hideLoading();
        updateCityName(weatherData.latitude, weatherData.longitude);
        updateCurrentTime();
        updateHeroCard();
        updateWeatherAnimation();
        updateHourlyCards();
        updateWeeklyForecast();
        updateMetrics();
        renderVisibleTempChart();
      });
    }

    // Hide loading states
    function hideLoading() {
      document.getElementById('loading-hero').classList.add('hidden');
      document.getElementById('hero-card').classList.remove('hidden');
    }

    // Show error state
    function showError(message) {
      console.error('Error:', message);
    }

    // Update city name with caching
    const cityNameCache = new Map();
    async function updateCityName(lat, lon) {
      const cacheKey = `${lat.toFixed(2)},${lon.toFixed(2)}`;
      
      if (cityNameCache.has(cacheKey)) {
        document.getElementById('city-name').textContent = cityNameCache.get(cacheKey);
        return;
      }

      try {
        const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
        const data = await response.json();
        const cityName = data.city || data.locality || 'Your Location';
        
        cityNameCache.set(cacheKey, cityName);
        document.getElementById('city-name').textContent = cityName;
      } catch (error) {
        const fallbackName = 'Your Location';
        cityNameCache.set(cacheKey, fallbackName);
        document.getElementById('city-name').textContent = fallbackName;
      }
    }

    // Update current time efficiently
    let timeUpdateInterval;
    function updateCurrentTime() {
      const updateTime = () => {
        const now = new Date();
        const timeStr = now.toLocaleString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit',
          hour12: true 
        });
        document.getElementById('current-time').textContent = 'Today ' + timeStr;
      };
      
      updateTime();
      
      if (timeUpdateInterval) clearInterval(timeUpdateInterval);
      timeUpdateInterval = setInterval(updateTime, 60000);
    }

    // Update hero card efficiently
    function updateHeroCard() {
      const { hourly } = weatherData;
      const now = new Date();
      const currentHour = now.getHours();
      
      const idx = Math.max(0, hourly.time.findIndex(t => new Date(t).getHours() >= currentHour) || 0);
      
      const temp = Math.round(hourly.temperature_2m[idx]);
      const humidity = Math.round(hourly.relative_humidity_2m[idx]);
      const wind = Math.round(hourly.wind_speed_10m[idx] * 3.6);
      const pressure = Math.round(hourly.pressure_msl[idx]);
      const precip = hourly.precipitation[idx] || 0;
      
      // Update elements efficiently
      const updates = [
        ['hero-temp', temp + '°'],
        ['hero-condition', getCondition(precip)],
        ['hero-humidity', humidity + '%'],
        ['hero-wind', wind + 'km/h'],
        ['hero-pressure', pressure + 'hpa'],
        ['temp-morning', Math.round(hourly.temperature_2m[Math.min(idx + 6, hourly.time.length - 1)]) + '°'],
        ['temp-afternoon', Math.round(hourly.temperature_2m[Math.min(idx + 12, hourly.time.length - 1)]) + '°'],
        ['temp-evening', Math.round(hourly.temperature_2m[Math.min(idx + 18, hourly.time.length - 1)]) + '°'],
        ['temp-night', Math.round(hourly.temperature_2m[Math.min(idx + 24, hourly.time.length - 1)]) + '°']
      ];
      
      updates.forEach(([id, value]) => {
        const element = document.getElementById(id);
        if (element) element.textContent = value;
      });
    }

    // Update weather animations based on conditions
    function updateWeatherAnimation() {
      const { hourly } = weatherData;
      const now = new Date();
      const currentHour = now.getHours();
      const idx = Math.max(0, hourly.time.findIndex(t => new Date(t).getHours() >= currentHour) || 0);
      
      const precip = hourly.precipitation[idx] || 0;
      const heroCard = document.getElementById('hero-card');
      const particlesContainer = document.getElementById('weather-particles');
      
      // Clear existing animations
      particlesContainer.innerHTML = '';
      heroCard.className = heroCard.className.replace(/\b(sunny|rainy|cloudy|night)\b/g, '');
      
      // Determine weather condition and add appropriate class and animations
      if (precip > 1) {
        heroCard.classList.add('rainy');
        createRainAnimation(particlesContainer);
      } else if (precip > 0) {
        heroCard.classList.add('cloudy');
        createCloudAnimation(particlesContainer);
      } else if (currentHour >= 6 && currentHour <= 18) {
        heroCard.classList.add('sunny');
        createSunAnimation(particlesContainer);
      } else {
        heroCard.classList.add('night');
        createNightAnimation(particlesContainer);
      }
    }

    // Create rain animation
    function createRainAnimation(container) {
      for (let i = 0; i < 30; i++) {
        const drop = document.createElement('div');
        drop.className = 'rain-drop';
        drop.style.left = Math.random() * 100 + '%';
        drop.style.animationDelay = Math.random() * 2 + 's';
        drop.style.animationDuration = (0.5 + Math.random() * 0.5) + 's';
        container.appendChild(drop);
      }
    }

    // Create sun animation
    function createSunAnimation(container) {
      const sunRays = document.createElement('div');
      sunRays.className = 'sun-rays';
      sunRays.innerHTML = `
        <svg width="300" height="300" viewBox="0 0 300 300">
          <g stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none">
            <line x1="150" y1="50" x2="150" y2="80" />
            <line x1="150" y1="220" x2="150" y2="250" />
            <line x1="50" y1="150" x2="80" y2="150" />
            <line x1="220" y1="150" x2="250" y2="150" />
            <line x1="85" y1="85" x2="107" y2="107" />
            <line x1="193" y1="193" x2="215" y2="215" />
            <line x1="215" y1="85" x2="193" y2="107" />
            <line x1="107" y1="193" x2="85" y2="215" />
          </g>
        </svg>
      `;
      container.appendChild(sunRays);
    }

    // Create cloud animation
    function createCloudAnimation(container) {
      for (let i = 0; i < 3; i++) {
        const cloud = document.createElement('div');
        cloud.className = 'floating-clouds';
        cloud.style.top = (20 + i * 20) + '%';
        cloud.style.left = (10 + i * 30) + '%';
        cloud.style.animationDelay = (i * 5) + 's';
        container.appendChild(cloud);
      }
    }

    // Create night animation
    function createNightAnimation(container) {
      for (let i = 0; i < 15; i++) {
        const star = document.createElement('div');
        star.style.position = 'absolute';
        star.style.width = '2px';
        star.style.height = '2px';
        star.style.backgroundColor = 'rgba(255,255,255,0.8)';
        star.style.borderRadius = '50%';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 60 + '%';
        star.style.animation = `twinkle ${1 + Math.random() * 2}s ease-in-out infinite alternate`;
        container.appendChild(star);
      }
      
      if (!document.querySelector('#twinkle-style')) {
        const style = document.createElement('style');
        style.id = 'twinkle-style';
        style.textContent = `
          @keyframes twinkle {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // Get weather condition
    function getCondition(precip) {
      if (precip > 2) return 'Heavy Rain';
      if (precip > 0.5) return 'Light Rain';
      if (precip > 0) return 'Drizzle';
      return 'Mostly Clear';
    }

    // FIXED: Enhanced SVG temperature chart with HIGH CONTRAST
    function renderVisibleTempChart() {
      const svg = document.getElementById('temp-svg-chart');
      if (!svg || !weatherData) return;
      
      const { hourly } = weatherData;
      const temps = hourly.temperature_2m.slice(0, 12);
      
      if (temps.length === 0) return;
      
      const width = 400;
      const height = 90;
      const padding = 30;
      const chartWidth = width - padding * 2;
      const chartHeight = height - padding * 2;
      
      const minTemp = Math.min(...temps) - 1;
      const maxTemp = Math.max(...temps) + 1;
      const tempRange = maxTemp - minTemp || 1;
      
      // Create path for line and area
      let pathData = '';
      let areaData = '';
      const points = [];
      
      temps.forEach((temp, i) => {
        const x = padding + (i / Math.max(temps.length - 1, 1)) * chartWidth;
        const y = padding + ((maxTemp - temp) / tempRange) * chartHeight;
        
        points.push({ x, y, temp: Math.round(temp), hour: i });
        const command = i === 0 ? 'M' : 'L';
        pathData += `${command} ${x} ${y}`;
        
        if (i === 0) {
          areaData = `M ${x} ${height - padding} L ${x} ${y}`;
        } else {
          areaData += ` L ${x} ${y}`;
        }
      });
      
      areaData += ` L ${points[points.length - 1]?.x || padding} ${height - padding} Z`;
      
      // Create hour labels
      let labels = '';
      points.forEach((point, i) => {
        if (i % 2 === 0) { // Show every other label to avoid crowding
          const hourLabel = ['12a', '2a', '4a', '6a', '8a', '10a', '12p', '2p', '4p', '6p', '8p', '10p'][i] || `${i}`;
          labels += `<text x="${point.x}" y="${height - 8}" class="chart-label">${hourLabel}</text>`;
        }
      });
      
      // Build SVG content with HIGH VISIBILITY
      svg.innerHTML = `
        <path d="${areaData}" class="temp-area" />
        <path d="${pathData}" class="temp-line" />
        ${points.map(p => `
          <circle cx="${p.x}" cy="${p.y}" r="5" class="temp-point" 
                  data-temp="${p.temp}°" data-hour="${p.hour}"
                  onmouseover="this.setAttribute('r','7')" 
                  onmouseout="this.setAttribute('r','5')" />
        `).join('')}
        ${labels}
      `;
    }

    // Update hourly cards with VISIBLE weather icons
    function updateHourlyCards() {
      const container = document.getElementById('hourly-cards');
      const { hourly } = weatherData;
      const now = new Date();
      const currentHour = now.getHours();
      
      const fragment = document.createDocumentFragment();
      
      for (let i = 0; i < Math.min(12, hourly.time.length); i++) {
        const date = new Date(hourly.time[i]);
        const hour = date.getHours();
        const temp = Math.round(hourly.temperature_2m[i]);
        const precip = hourly.precipitation[i] || 0;
        const isNow = hour === currentHour && i === 0;
        
        const card = document.createElement('div');
        card.className = `hour-card ${isNow ? 'active' : ''} p-4 flex-shrink-0`;
        card.innerHTML = `
          <p class="font-semibold text-center mb-3 text-sm ${isNow ? 'text-white' : 'text-gray-800'}">
            ${isNow ? 'Now' : formatHour(hour)}
          </p>
          <div class="w-12 h-12 mx-auto mb-3 weather-icon flex items-center justify-center">
            ${getVisibleWeatherIcon(precip, hour)}
          </div>
          <p class="text-2xl font-bold text-center ${isNow ? 'text-white' : 'text-gray-800'}">${temp}°</p>
        `;
        
        fragment.appendChild(card);
      }
      
      container.innerHTML = '';
      container.appendChild(fragment);
    }

    // Format hour efficiently
    function formatHour(hour) {
      if (hour === 0) return '12 AM';
      if (hour < 12) return hour + ' AM';
      if (hour === 12) return '12 PM';
      return (hour - 12) + ' PM';
    }

    // FIXED: High contrast weather icons that are always visible
    function getVisibleWeatherIcon(precip, hour) {
      const isDay = hour >= 6 && hour < 18;
      const size = 'w-full h-full';
      
      if (precip > 1) {
        return `
          <svg viewBox="0 0 48 48" class="${size}">
            <ellipse cx="24" cy="16" rx="12" ry="8" fill="#6b7280"/>
            <line x1="18" y1="28" x2="16" y2="38" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
            <line x1="24" y1="28" x2="22" y2="38" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
            <line x1="30" y1="28" x2="28" y2="38" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
          </svg>`;
      } else if (precip > 0) {
        return `
          <svg viewBox="0 0 26 26" class="${size} align-middle">
<path d="M19.9001 2.30719C19.7392 1.8976 19.1616 1.8976 19.0007 2.30719L18.5703 3.40247C18.5212 3.52752 18.4226 3.62651 18.298 3.67583L17.2067 4.1078C16.7986 4.26934 16.7986 4.849 17.2067 5.01054L18.298 5.44252C18.4226 5.49184 18.5212 5.59082 18.5703 5.71587L19.0007 6.81115C19.1616 7.22074 19.7392 7.22074 19.9001 6.81116L20.3305 5.71587C20.3796 5.59082 20.4782 5.49184 20.6028 5.44252L21.6941 5.01054C22.1022 4.849 22.1022 4.26934 21.6941 4.1078L20.6028 3.67583C20.4782 3.62651 20.3796 3.52752 20.3305 3.40247L19.9001 2.30719Z" fill="#1C274C"/>
<path d="M16.0328 8.12967C15.8718 7.72009 15.2943 7.72009 15.1333 8.12967L14.9764 8.52902C14.9273 8.65407 14.8287 8.75305 14.7041 8.80237L14.3062 8.95987C13.8981 9.12141 13.8981 9.70107 14.3062 9.86261L14.7041 10.0201C14.8287 10.0694 14.9273 10.1684 14.9764 10.2935L15.1333 10.6928C15.2943 11.1024 15.8718 11.1024 16.0328 10.6928L16.1897 10.2935C16.2388 10.1684 16.3374 10.0694 16.462 10.0201L16.8599 9.86261C17.268 9.70107 17.268 9.12141 16.8599 8.95987L16.462 8.80237C16.3374 8.75305 16.2388 8.65407 16.1897 8.52902L16.0328 8.12967Z" fill="#1C274C"/>
<path opacity="0.5" d="M12 22C17.5228 22 22 17.5228 22 12C22 11.5373 21.3065 11.4608 21.0672 11.8568C19.9289 13.7406 17.8615 15 15.5 15C11.9101 15 9 12.0899 9 8.5C9 6.13845 10.2594 4.07105 12.1432 2.93276C12.5392 2.69347 12.4627 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="#1C274C"/>
          </svg>`;
      } else if (isDay) {
        return `
          <svg viewBox="0 0 48 48" class="${size}">
            <circle cx="24" cy="24" r="10" fill="#fbbf24" stroke="#f59e0b" stroke-width="1"/>
            <g stroke="#f59e0b" stroke-width="2" stroke-linecap="round">
              <line x1="24" y1="6" x2="24" y2="12"/>
              <line x1="24" y1="36" x2="24" y2="42"/>
              <line x1="6" y1="24" x2="12" y2="24"/>
              <line x1="36" y1="24" x2="42" y2="24"/>
              <line x1="10.5" y1="10.5" x2="15.2" y2="15.2"/>
              <line x1="32.8" y1="32.8" x2="37.5" y2="37.5"/>
              <line x1="37.5" y1="10.5" x2="32.8" y2="15.2"/>
              <line x1="15.2" y1="32.8" x2="10.5" y2="37.5"/>
            </g>
          </svg>`;
      } else {
        return `
          <svg viewBox="0 0 26 26" class="${size} align-middle">
<path d="M19.9001 2.30719C19.7392 1.8976 19.1616 1.8976 19.0007 2.30719L18.5703 3.40247C18.5212 3.52752 18.4226 3.62651 18.298 3.67583L17.2067 4.1078C16.7986 4.26934 16.7986 4.849 17.2067 5.01054L18.298 5.44252C18.4226 5.49184 18.5212 5.59082 18.5703 5.71587L19.0007 6.81115C19.1616 7.22074 19.7392 7.22074 19.9001 6.81116L20.3305 5.71587C20.3796 5.59082 20.4782 5.49184 20.6028 5.44252L21.6941 5.01054C22.1022 4.849 22.1022 4.26934 21.6941 4.1078L20.6028 3.67583C20.4782 3.62651 20.3796 3.52752 20.3305 3.40247L19.9001 2.30719Z" fill="#1C274C"/>
<path d="M16.0328 8.12967C15.8718 7.72009 15.2943 7.72009 15.1333 8.12967L14.9764 8.52902C14.9273 8.65407 14.8287 8.75305 14.7041 8.80237L14.3062 8.95987C13.8981 9.12141 13.8981 9.70107 14.3062 9.86261L14.7041 10.0201C14.8287 10.0694 14.9273 10.1684 14.9764 10.2935L15.1333 10.6928C15.2943 11.1024 15.8718 11.1024 16.0328 10.6928L16.1897 10.2935C16.2388 10.1684 16.3374 10.0694 16.462 10.0201L16.8599 9.86261C17.268 9.70107 17.268 9.12141 16.8599 8.95987L16.462 8.80237C16.3374 8.75305 16.2388 8.65407 16.1897 8.52902L16.0328 8.12967Z" fill="#1C274C"/>
<path opacity="0.5" d="M12 22C17.5228 22 22 17.5228 22 12C22 11.5373 21.3065 11.4608 21.0672 11.8568C19.9289 13.7406 17.8615 15 15.5 15C11.9101 15 9 12.0899 9 8.5C9 6.13845 10.2594 4.07105 12.1432 2.93276C12.5392 2.69347 12.4627 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="#1C274C"/>
          </svg>`;
      }
    }

    // Update weekly forecast with VISIBLE icons
    function updateWeeklyForecast() {
      const container = document.getElementById('weekly-forecast');
      const { daily } = weatherData;
      
      const fragment = document.createDocumentFragment();
      
      for (let i = 0; i < Math.min(7, daily.time.length); i++) {
        const date = new Date(daily.time[i]);
        const dayName = i === 0 ? 'Today' : i === 1 ? 'Tomorrow' : date.toLocaleDateString('en-US', { weekday: 'long' });
        const dateStr = date.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
        const maxTemp = Math.round(daily.temperature_2m_max[i]);
        const precip = daily.precipitation_sum[i] || 0;
        
        const item = document.createElement('div');
        item.className = `forecast-item px-4 py-4 ${i === 0 ? 'bg-gray-100' : 'bg-white text-gray-800'}`;
        item.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <p class="font-semibold">${dayName}</p>
              <p class="text-xs mt-1">${dateStr}</p>
            </div>
            <div class="flex items-center gap-3">
              <span class="text-2xl font-semibold">${maxTemp}°</span>
              <div class="w-10 h-10 weather-icon flex-shrink-0 flex items-center justify-center">
                ${getVisibleWeatherIcon(precip, 12)}
              </div>
            </div>
          </div>
        `;
        
        fragment.appendChild(item);
      }
      
      container.innerHTML = '';
      container.appendChild(fragment);
    }

    // Update metrics efficiently
    function updateMetrics() {
      const { hourly } = weatherData;
      const now = new Date();
      const currentHour = now.getHours();
      
      const idx = Math.max(0, hourly.time.findIndex(t => new Date(t).getHours() >= currentHour) || 0);
      
      const wind = Math.round(hourly.wind_speed_10m[idx] * 3.6);
      const windDir = hourly.wind_direction_10m[idx] || 0;
      const precipProb = Math.round(hourly.precipitation_probability[idx] || 0);
      const pressure = Math.round(hourly.pressure_msl[idx] || 1013);
      const uvIndex = Math.round(hourly.uv_index[idx] || 0);
      
      // Batch DOM updates
      const updates = [
        ['wind-speed', wind + 'km/h'],
        ['rain-chance', precipProb + '%'],
        ['rain-label', precipProb < 30 ? 'Low' : precipProb < 70 ? 'Medium' : 'High'],
        ['pressure-value', pressure + ' hpa'],
        ['uv-value', uvIndex],
        ['uv-label', uvIndex < 3 ? 'Low' : uvIndex < 6 ? 'Medium' : uvIndex < 8 ? 'High' : 'Very High']
      ];
      
      updates.forEach(([id, value]) => {
        const element = document.getElementById(id);
        if (element) element.textContent = value;
      });
      
      // Update visual indicators
      updateWindDirection(windDir);
      updateRainArc(precipProb);
      updatePressureArc(pressure);
      updateUvArc(uvIndex);
    }

    // Update wind direction efficiently
    function updateWindDirection(degrees) {
      const arrow = document.getElementById('wind-arrow');
      if (!arrow) return;
      
      const radians = (degrees - 90) * (Math.PI / 180);
      const x2 = 24 + 14 * Math.cos(radians);
      const y2 = 24 + 14 * Math.sin(radians);
      arrow.setAttribute('x2', x2);
      arrow.setAttribute('y2', y2);
    }

    // Update arc indicators efficiently
    function updateRainArc(percentage) {
      const arc = document.getElementById('rain-arc');
      if (!arc) return;
      
      const circumference = 2 * Math.PI * 18;
      const offset = circumference - (percentage / 100) * circumference;
      arc.style.strokeDashoffset = offset;
    }

    function updatePressureArc(pressure) {
      const arc = document.getElementById('pressure-arc');
      if (!arc) return;
      
      const normalizedPressure = Math.max(0, Math.min(100, ((pressure - 980) / 60) * 100));
      const circumference = 2 * Math.PI * 18;
      const offset = circumference - (normalizedPressure / 100) * circumference;
      arc.style.strokeDashoffset = offset;
    }

    function updateUvArc(uvIndex) {
      const arc = document.getElementById('uv-arc');
      if (!arc) return;
      
      const normalizedUv = Math.max(0, Math.min(100, (uvIndex / 11) * 100));
      const circumference = 2 * Math.PI * 18;
      const offset = circumference - (normalizedUv / 100) * circumference;
      arc.style.strokeDashoffset = offset;
    }

    // Add resize handler with debouncing
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    const debouncedResize = debounce(() => {
      if (weatherData) {
        renderVisibleTempChart();
      }
    }, 250);

    window.addEventListener('resize', debouncedResize);

    // Add visibility change handler to pause updates when page is hidden
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        if (timeUpdateInterval) {
          clearInterval(timeUpdateInterval);
          timeUpdateInterval = null;
        }
      } else {
        updateCurrentTime();
      }
    });

    // Initialize app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
